<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbre de Tournoi - Association Sportive</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="equipe.html">Notre Ã‰quipe</a></li>
            <li><a href="historique.html">Historique des Tournois</a></li>
            <li><a href="tournoi.html">Arbre de Tournoi</a></li>
        </ul>
    </nav>

    <div class="container xlarge">
        <div class="page-header">
            <h1>Arbre de Tournoi</h1>
            <p>Suivez la progression des Ã©quipes en direct</p>
        </div>

        <div class="admin-panel">
            <div class="admin-toggle">
                <button class="admin-btn" id="adminLoginBtn" onclick="showLoginForm()">
                    Mode Administrateur
                </button>
            </div>

            <!-- Formulaire d'authentification -->
            <div class="admin-login" id="adminLogin">
                <div class="login-form">
                    <h3>Authentification Administrateur</h3>
                    <div class="form-group">
                        <label for="adminUsername">Login:</label>
                        <input type="text" id="adminUsername" placeholder="Identifiant">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe:</label>
                        <input type="password" id="adminPassword" placeholder="Mot de passe">
                    </div>
                    <div class="login-actions">
                        <button class="btn btn-primary" onclick="attemptLogin()">Se connecter</button>
                        <button class="btn btn-secondary" onclick="cancelLogin()">Annuler</button>
                    </div>
                    <div id="loginError" class="error-message"></div>
                </div>
            </div>

            <div class="admin-controls" id="adminControls">
                <div class="control-group">
                    <label for="numTeams">Nombre d'Ã©quipes:</label>
                    <select id="numTeams" onchange="updateTeamInputs()">
                        <option value="4">4 Ã©quipes</option>
                        <option value="8" selected>8 Ã©quipes</option>
                        <option value="16">16 Ã©quipes</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="tournamentName">Nom du tournoi:</label>
                    <input type="text" id="tournamentName" placeholder="Ex: Tournoi d'Hiver 2025">
                </div>

                <div class="control-group">
                    <label for="tournamentDate">Date:</label>
                    <input type="date" id="tournamentDate">
                </div>

                <div class="info-message">
                    <strong>Instructions:</strong> Configurez le tournoi ci-dessus, puis entrez les noms des Ã©quipes ci-dessous.
                </div>

                <div class="control-group" style="grid-column: 1 / -1;">
                    <label>Noms des Ã©quipes:</label>
                    <div class="team-inputs" id="teamInputs">
                        <!-- Les inputs seront gÃ©nÃ©rÃ©s dynamiquement -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateBracket()">
                        ðŸŽ² GÃ©nÃ©rer l'Arbre
                    </button>
                    <button class="btn btn-success" onclick="saveTournament()">
                        ðŸ’¾ Sauvegarder
                    </button>
                    <button class="btn btn-danger" onclick="resetTournament()">
                        ðŸ”„ RÃ©initialiser
                    </button>
                    <button class="btn btn-warning" onclick="logout()">
                        ðŸšª DÃ©connexion
                    </button>
                </div>
            </div>
        </div>

        <div class="tournament-container">
            <div id="bracketContainer">
                <div class="info-message">
                    Cliquez sur "Mode Administrateur" pour crÃ©er un nouveau tournoi, ou visualisez le tournoi en cours ci-dessous.
                </div>
            </div>
            <div id="championSection"></div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Association Sportive - Tous droits rÃ©servÃ©s</p>
    </footer>

    <script>
        let isAdminMode = false;
        let isAuthenticated = false;
        let tournamentData = {
            teams: [],
            matches: [],
            rounds: []
        };

        // Credentials d'authentification
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'caca';

        function showLoginForm() {
            if (isAuthenticated) {
                toggleAdminMode();
            } else {
                document.getElementById('adminLogin').style.display = 'block';
                document.getElementById('adminUsername').focus();
            }
        }

        function attemptLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                errorDiv.textContent = '';

                // Changer le texte du bouton
                document.getElementById('adminLoginBtn').textContent = 'Mode Administrateur (ConnectÃ©)';

                toggleAdminMode();
            } else {
                errorDiv.textContent = 'Identifiant ou mot de passe incorrect';
                errorDiv.style.color = 'red';
                errorDiv.style.marginTop = '10px';
            }
        }

        function cancelLogin() {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('loginError').textContent = '';
        }

        function logout() {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir vous dÃ©connecter ?')) {
                isAuthenticated = false;
                isAdminMode = false;
                document.getElementById('adminControls').classList.remove('active');
                document.getElementById('adminLoginBtn').textContent = 'Mode Administrateur';
            }
        }

        // Gestion de la touche EntrÃ©e dans le formulaire
        document.addEventListener('DOMContentLoaded', function() {
            const passwordField = document.getElementById('adminPassword');
            const usernameField = document.getElementById('adminUsername');

            if (passwordField) {
                passwordField.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        attemptLogin();
                    }
                });
            }

            if (usernameField) {
                usernameField.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        attemptLogin();
                    }
                });
            }
        });

        // Charger un tournoi de dÃ©monstration
        function loadDemoTournament() {
            const demoTeams = [
                'Les Titans', 'Les Guerriers', 'Les Faucons', 'Les Aigles',
                'Les Champions', 'Les Warriors', 'Les Pumas', 'Les LÃ©gendes'
            ];
            
            document.getElementById('numTeams').value = '8';
            updateTeamInputs();
            
            demoTeams.forEach((team, index) => {
                document.getElementById(`team${index}`).value = team;
            });
            
            generateBracket();
        }

        function toggleAdminMode() {
            if (!isAuthenticated) {
                alert('Veuillez vous connecter pour accÃ©der au mode administrateur.');
                return;
            }

            isAdminMode = !isAdminMode;
            const controls = document.getElementById('adminControls');
            controls.classList.toggle('active');

            // Mettre Ã  jour le texte du bouton
            const btn = document.getElementById('adminLoginBtn');
            if (isAdminMode) {
                btn.textContent = 'Fermer le Panneau Admin';
            } else {
                btn.textContent = 'Mode Administrateur (ConnectÃ©)';
            }
        }

        function updateTeamInputs() {
            const numTeams = parseInt(document.getElementById('numTeams').value);
            const container = document.getElementById('teamInputs');
            container.innerHTML = '';

            for (let i = 0; i < numTeams; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `team${i}`;
                input.placeholder = `Ã‰quipe ${i + 1}`;
                input.className = 'control-group';
                container.appendChild(input);
            }
        }

        function generateBracket() {
            const numTeams = parseInt(document.getElementById('numTeams').value);
            const teams = [];

            for (let i = 0; i < numTeams; i++) {
                const teamName = document.getElementById(`team${i}`).value || `Ã‰quipe ${i + 1}`;
                teams.push({ name: teamName, score: 0 });
            }

            tournamentData.teams = teams;
            createBracket(teams);
        }

        function createBracket(teams) {
            const container = document.getElementById('bracketContainer');
            container.innerHTML = '';

            const numRounds = Math.log2(teams.length);
            const bracket = document.createElement('div');
            bracket.className = 'bracket';

            for (let round = 0; round < numRounds; round++) {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'round';

                const roundTitle = document.createElement('div');
                roundTitle.className = 'round-title';
                
                if (round === numRounds - 1) {
                    roundTitle.textContent = ' FINALE';
                } else if (round === numRounds - 2) {
                    roundTitle.textContent = 'âš¡ DEMI-FINALES';
                } else if (round === numRounds - 3) {
                    roundTitle.textContent = 'ðŸ”¥ QUARTS DE FINALE';
                } else {
                    roundTitle.textContent = `TOUR ${round + 1}`;
                }
                
                roundDiv.appendChild(roundTitle);

                const matchesInRound = teams.length / Math.pow(2, round + 1);
                
                for (let match = 0; match < matchesInRound; match++) {
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'match';
                    matchDiv.dataset.round = round;
                    matchDiv.dataset.match = match;

                    if (round === 0) {
                        const team1Index = match * 2;
                        const team2Index = match * 2 + 1;

                        matchDiv.innerHTML = `
                            <div class="team" onclick="selectWinner(${round}, ${match}, 0)">
                                <span class="team-name">${teams[team1Index].name}</span>
                                <span class="team-score">0</span>
                            </div>
                            <div class="team" onclick="selectWinner(${round}, ${match}, 1)">
                                <span class="team-name">${teams[team2Index].name}</span>
                                <span class="team-score">0</span>
                            </div>
                        `;
                    } else {
                        matchDiv.innerHTML = `
                            <div class="team empty-slot">
                                <span class="team-name">En attente...</span>
                            </div>
                            <div class="team empty-slot">
                                <span class="team-name">En attente...</span>
                            </div>
                        `;
                    }

                    roundDiv.appendChild(matchDiv);
                }

                bracket.appendChild(roundDiv);
            }

            container.appendChild(bracket);
        }

        function selectWinner(round, matchIndex, teamIndex) {
            if (!isAuthenticated || !isAdminMode) {
                alert('Activez le mode administrateur pour modifier les rÃ©sultats.');
                return;
            }

            const match = document.querySelector(`[data-round="${round}"][data-match="${matchIndex}"]`);
            const teams = match.querySelectorAll('.team');
            
            // Retirer la classe winner de toutes les Ã©quipes du match
            teams.forEach(team => team.classList.remove('winner'));
            
            // Ajouter la classe winner Ã  l'Ã©quipe sÃ©lectionnÃ©e
            teams[teamIndex].classList.add('winner');

            // Obtenir le nom de l'Ã©quipe gagnante
            const winnerName = teams[teamIndex].querySelector('.team-name').textContent;

            // Mettre Ã  jour le tour suivant
            updateNextRound(round, matchIndex, winnerName);

            // VÃ©rifier si c'est la finale
            if (round === Math.log2(tournamentData.teams.length) - 1) {
                displayChampion(winnerName);
            }
        }

        function updateNextRound(currentRound, currentMatch, winnerName) {
            const nextRound = currentRound + 1;
            const nextMatch = Math.floor(currentMatch / 2);
            const position = currentMatch % 2;

            const nextMatchElement = document.querySelector(`[data-round="${nextRound}"][data-match="${nextMatch}"]`);
            
            if (nextMatchElement) {
                const teams = nextMatchElement.querySelectorAll('.team');
                if (teams[position]) {
                    teams[position].innerHTML = `
                        <span class="team-name">${winnerName}</span>
                        <span class="team-score">0</span>
                    `;
                    teams[position].classList.remove('empty-slot');
                    teams[position].onclick = () => selectWinner(nextRound, nextMatch, position);
                }
            }
        }

        function displayChampion(championName) {
            const championSection = document.getElementById('championSection');
            championSection.innerHTML = `
                <div class="champion-section">
                    <div class="champion-trophy"></div>
                    <div class="champion-name">CHAMPION: ${championName}</div>
                    <p style="margin-top: 1rem; font-size: 1.2rem;">FÃ©licitations Ã  l'Ã©quipe gagnante !</p>
                </div>
            `;
        }

        function saveTournament() {
            const tournamentName = document.getElementById('tournamentName').value || 'Tournoi sans nom';
            const tournamentDate = document.getElementById('tournamentDate').value || new Date().toISOString().split('T')[0];

            const data = {
                name: tournamentName,
                date: tournamentDate,
                teams: tournamentData.teams,
                timestamp: new Date().toISOString()
            };

            // Dans une vraie application, on enverrait Ã§a Ã  un serveur
            localStorage.setItem('currentTournament', JSON.stringify(data));
            alert('Tournoi sauvegardÃ© avec succÃ¨s !');
        }

        function resetTournament() {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir rÃ©initialiser le tournoi ?')) {
                location.reload();
            }
        }

        // Initialisation
        window.onload = function() {
            updateTeamInputs();
            
            // Charger le tournoi sauvegardÃ© s'il existe
            const saved = localStorage.getItem('currentTournament');
            if (saved) {
                // On pourrait restaurer le tournoi ici
            } else {
                // Charger un tournoi de dÃ©mo
                loadDemoTournament();
            }
        };
    </script>
</body>
</html>
